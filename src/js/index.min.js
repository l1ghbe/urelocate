function getQueryParams(){const e=new URLSearchParams(window.location.search);["utm_source","utm_campaign","AgId","utm_term","AdPos","utm_content","device","GeoLoc","utm_medium"].forEach((t=>{e.has(t)&&(console.log(t),document.cookie=`${t}=${e.get(t)}; path=/; max-age=172800`)}))}function getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function executePageSpecificCode(){commonScripts();const e=window.location.pathname;e.endsWith("index.html")||"/"===e?initializeHomePageScripts():console.log("No specific code for this page.")}function commonScripts(){getQueryParams();const e=document.querySelector(".mobile-menu-icon"),t=document.querySelector(".nav__mobile"),o=document.querySelector(".checkbox");t.addEventListener("click",(e=>{e.target.classList.contains("nav__link")&&(o.checked=!1)})),e.addEventListener("click",(()=>{const t=e.getAttribute("src");t.endsWith("close.svg")&&e.setAttribute("src","./assets/img/dist/icons/burger.svg"),t.endsWith("burger.svg")&&e.setAttribute("src","./assets/img/dist/icons/close.svg")}));const n=document.querySelector(".chip__labels"),r=document.querySelectorAll(".chip__label");n&&n.addEventListener("click",(e=>{e.target.classList.contains("chip__label")&&(r.forEach((e=>e.classList.remove("chip__label--active"))),e.target.classList.add("chip__label--active"))})),document.querySelectorAll(".view__rb").forEach((e=>{e.addEventListener("change",(function(){document.querySelectorAll(".chip__label").forEach((e=>{e.classList.remove("chip__label--active")}));const e=document.querySelector(`label[for="${this.id}"]`);e&&e.classList.add("chip__label--active")}))}))}function initializeHomePageScripts(){const e=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){const o=t.target,n=o.querySelector("source"),r=n.dataset.src;n.src=r,o.load(),e.unobserve(o)}}))}),{rootMargin:"200px 0px 0px",threshold:.5});document.querySelectorAll(".prod-icon-cont").forEach((t=>{e.observe(t)}))}executePageSpecificCode();const instructionsradioButtonsBlock=document.querySelector(".instructions-view__rbs"),instructionsHeadingEl=document.querySelector(".instructions-view-heading"),instructionsParagraphEl=document.querySelector(".instructions-view-paragraph"),instructionLinkEl=document.querySelector(".view-inctruction-link"),instructionsVideoSrcEl=document.querySelector(".instructions-view-videoSrc"),instructionsVideoEl=document.querySelector(".instructions-view__video");function getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null}function getUtmParamsFromCookies(){const e={};return["utm_source","utm_campaign","AgId","utm_term","AdPos","utm_content","device","GeoLoc","utm_medium"].forEach((t=>{const o=getCookie(t);o&&(e[t]=o)})),e}function initFormSubmission(e){const t=e.privateBotToken,o=e.privateChatId,n=e.googleSheetWebAppUrl,r=document.getElementById("telegramForm");t&&o?r.addEventListener("submit",(e=>handleFormSubmit(e,t,o,n))):console.error("–¢–æ–∫–µ–Ω –ª–∏–±–æ —á–∞—Ç –∞–π–¥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.")}async function handleFormSubmit(e,t,o,n){e.preventDefault();const r=document.getElementById("form-name").value.trim();let c=document.getElementById("form-tg").value.trim();const s=document.getElementById("form-email").value.trim(),a=document.getElementById("form-comment").value.trim(),i=n;if(!r||!c||!s)return void alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è.");c.startsWith("@")||(c=`@${c}`);const l=createTelegramMessage(r,c,s,a);try{sendTelegramMessage(t,o,l);const e=getUtmParamsFromCookies(),{utm_source:n,utm_term:s,GeoLoc:a,AgId:d,utm_campaign:m}=e||{},u=new Date,g=`${String(u.getDate()).padStart(2,"0")}.${String(u.getMonth()+1).padStart(2,"0")}.${u.getFullYear()}`;try{await appendToGoogleSheet({webAppUrl:i,name:r,telegram:c,source:n||"",campaign:m||"",keywords:s||"",region:a||"",date:g||"",hasPurchase:"–Ω–µ—Ç",relevance:"–Ω–µ—Ç"})}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets",e)}finally{sessionStorage.setItem("formSubmitted","true"),window.location.href="/thank-you.html"}}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram",e)}}function createTelegramMessage(e,t,o,n){const r=getUtmParamsFromCookies();let c="";for(const[e,t]of Object.entries(r))c+=`${e}: ${t}\n`;return`\n    –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ üìß:\n–ò–º—è: ${e}\nTelegram: ${t}\n–ü–æ—á—Ç–∞: ${o}\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${n}\n\nUTM –¥–∞–Ω–Ω—ã–µ ü§ñ:\n${c||"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"}\n  `}function sendTelegramMessage(e,t,o){fetch(`https://api.telegram.org/bot${e}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:t,text:o,parse_mode:"HTML"})}).then((e=>e.json())).then((e=>{e.ok?(alert("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"),resetForm()):(console.error("Error response from Telegram API:",e),alert("–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã."))})).catch((e=>{console.error("Network error:",e),alert("–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")}))}async function appendToGoogleSheet({webAppUrl:e,name:t,telegram:o,source:n,campaign:r,keywords:c,region:s,date:a,hasPurchase:i,relevance:l}){const d={name:t,telegram:o,source:n,campaign:r,keywords:c,region:s,date:a,hasPurchase:i,relevance:l};try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(d)})).ok)throw new Error("Failed to append data to Google Sheets.");console.log("Data appended to Google Sheets successfully.")}catch(e){console.error("Error appending data to Google Sheets:",e)}}function resetForm(){document.getElementById("telegramForm").reset()}fetch("./json/instructions.json").then((e=>{if(!e.ok)throw new Error("Failed to load JSON");return e.json()})).then((e=>{instructionsradioButtonsBlock&&instructionsradioButtonsBlock.addEventListener("click",(t=>{if(t.target&&"radio"===t.target.type){const o=t.target.id;try{const{heading:t,paragraph:n,instructionLink:r,videoSrc:c}=e[o];instructionsHeadingEl.textContent=t,instructionsParagraphEl.textContent=n,instructionLinkEl.setAttribute("data-download-url",r),instructionsVideoSrcEl.src=c,instructionsVideoEl.load()}catch(e){console.error(e)}}}))})),fetch("./config/config.json").then((e=>{if(!e.ok)throw new Error("Failed to load config file.");return e.json()})).then(initFormSubmission).catch((e=>console.error("Error loading config:",e))),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("popupOverlay"),t=document.getElementById("popupForm"),o=document.getElementById("closePopup"),n=document.getElementById("telegramPopupForm"),r=document.querySelectorAll(".view-inctruction-link");let c,s,a;try{const e=await fetch("./config/config.json");if(!e.ok)throw new Error("Failed to load config file.");const t=await e.json();c=t.privateBotToken,s=t.privateChatId,a=t.googleSheetWebAppUrl}catch(e){return void console.error("Error loading config:",e)}r.forEach((o=>{o.addEventListener("click",(r=>{r.preventDefault(),console.log("popupOverlay",e),e.classList.add("show"),t.classList.add("show");const c=o.getAttribute("data-download-url");n.setAttribute("data-download-url",c)}))})),o.addEventListener("click",(()=>{e.classList.remove("show"),t.classList.remove("show")})),e.addEventListener("click",(()=>{e.classList.remove("show"),t.classList.remove("show")})),n.addEventListener("submit",(async o=>{o.preventDefault();const r=document.getElementById("popup-form-name").value.trim();let i=document.getElementById("popup-form-tg").value.trim();const l=document.getElementById("popup-form-email").value.trim(),d=n.getAttribute("data-download-url"),m="(–ò–Ω—Å—Ç—Ä) "+r;if(!r||!i||!l)return void alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è.");i.startsWith("@")||(i=`@${i}`);const u=createTelegramMessage(r,i,l,"-");try{await sendTelegramMessage(c,s,u);const o=getUtmParamsFromCookies(),{utm_source:r,utm_term:l,GeoLoc:g,AgId:h,utm_campaign:p}=o||{},f=new Date,v=`${String(f.getDate()).padStart(2,"0")}.${String(f.getMonth()+1).padStart(2,"0")}.${f.getFullYear()}`;if(await appendToGoogleSheet({webAppUrl:a,name:m,telegram:i,source:r||"",campaign:p||"",keywords:l||"",region:g||"",date:v||"",hasPurchase:"–Ω–µ—Ç",relevance:"–Ω–µ—Ç"}),d){const e=document.createElement("a");e.href=d,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else console.warn("Download URL is not set.");e.classList.remove("show"),t.classList.remove("show"),n.reset()}catch(e){console.error("Error during form submission:",e),alert("–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")}}))}));